# Turn-Based Simulation

This project is a discrete event simulation of a turn-based multiplayer game system, built using SimPy. It models player arrivals, matchmaking, game logic, and collects performance metrics to analyze system behavior under various conditions.

## Features

### Core Simulation Components
- **Player Arrival Simulation**: Supports both synthetic random arrivals (Poisson process) and CSV-driven inputs for deterministic player spawning.
- **Player Service**: Handles player authentication, storage, and publishes authenticated players to the system.
- **Matchmaking Service**: Manages player queues, creates matches when enough players are available or timeouts occur, with configurable batch processing.
- **Game Logic Service**: Simulates turn-based game execution, including variable turn counts, processing times, and state persistence.
- **Pub/Sub Communication**: Event-driven architecture using a publish-subscribe pattern for inter-service communication, with simulated network delays and message loss.
- **Storage Simulation**: Models database operations with configurable write latencies.
- **Metrics Collection**: Tracks key performance indicators including queue lengths, match creation rates, turn latencies, and match durations.

### Data Generation and Analysis
- **Data Generation Tools** (`data_gen/`): Scripts to generate synthetic datasets for players, matches, and turns with various distributions (e.g., skill levels, arrival times).
- **Analysis Tools** (`analysis/`): Post-simulation analysis scripts for deeper insights into simulation results.

### Visualization
- **Interactive Dashboard** (`analysis/analyze.py`): Uses Plotly and Dash to create interactive charts for metrics visualization with dropdown selectors for different metrics.
- **Static Plotting**: Matplotlib support for static plots and distributions.

### Configuration
- Highly configurable via `config.py`: Adjust simulation time, arrival rates, match parameters, network delays, and data sources.

## Installation Requirements

### Prerequisites
- Python 3.7 or higher
- pip package manager

### Dependencies
Install the required packages using:
```bash
pip install -r requirements.txt
```

Required libraries:
- `simpy>=4.0.1`: Discrete event simulation framework
- `pandas`: Data manipulation and analysis
- `pyyaml`: Configuration file parsing
- `numpy`: Numerical computations
- `plotly`: Interactive plotting and dashboards
- `matplotlib`: Static plotting (optional)

## How to Download and Run

### Downloading the Project
1. Visit the project's GitHub repository (replace with actual URL if available).
2. Click on the "Code" button and select "Download ZIP".
3. Extract the ZIP file to your desired directory.

Alternatively, if you have Git installed:
```bash
git clone <repository-url>
cd turnbased_sim
```

### Running the Simulation
1. Navigate to the project directory:
   ```bash
   cd /path/to/turnbased_sim
   ```

2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

3. Run the simulation:
   ```bash
   python sim_runner.py
   ```

The simulation will run for the configured duration (default: 30 minutes) and generate output files in the `outputs/` directory.

### Viewing Results
- **Metrics Dashboard**: Run `python analysis/analyze.py --dashboard` to launch an interactive Plotly dashboard showing simulation metrics.
- **Analysis Scripts**: Run `python analysis/analyze.py` to generate summary statistics and static plots (saved to the run folder).
- **Validation**: Run `python validation/run_validation.py` to validate simulation results and generate plots in `validation/results/`.
- **Output Files**: Check the latest `outputs/run_YYYYMMDD_HHMMSS/` directory for:
  - `metrics.csv`: Time-series data of collected metrics
  - `events.log`: Detailed event log of simulation activities
  - `summary_stats.csv`: Summary statistics generated by analysis scripts

### Configuration
Modify `config.py` to customize:
- Simulation duration
- Player arrival rates
- Match parameters
- Network delays and loss probabilities
- Data source (synthetic vs. CSV-driven)

## Expected Results

After running the simulation, you should expect:

1. **Console Output**: Progress messages indicating simulation start, player arrivals, match creations, and completion.

2. **Output Directory**: A new timestamped folder in `outputs/` containing:
   - `metrics.csv`: CSV file with timestamped metric values
   - `events.log`: Text log of all simulation events

3. **Metrics Dashboard**: Interactive plots showing:
   - Queue length over time
   - Cumulative matches created
   - Turn latency distributions
   - Match duration statistics

4. **Performance Insights**: Depending on configuration, you may observe:
   - Queue buildup during high arrival periods
   - Impact of matchmaking timeouts on match quality
   - Effects of network delays on overall system throughput
   - Turn processing bottlenecks in game logic

## Tools and Libraries Used

### Core Simulation
- **SimPy**: Primary framework for discrete event simulation, providing environment, processes, and event scheduling.

### Data Handling and Analysis
- **Pandas**: Data manipulation for metrics collection, CSV processing, and analysis.
- **NumPy**: Efficient numerical operations for statistical distributions and random sampling.

### Configuration and I/O
- **PyYAML**: Parsing configuration files for flexible parameter management.

### Visualization
- **Plotly**: Creating interactive web-based dashboards for metrics visualization.
- **Matplotlib**: Optional static plotting capabilities.

### Project Structure
- **core/**: Core simulation components (environment, message bus, storage, timer)
- **services/**: Microservice-style components (player, matchmaking, game logic, etc.)
- **utils/**: Utility functions (generators, metrics, logger)
- **data_gen/**: Data generation scripts
- **analysis/**: Post-simulation analysis tools
- **data/**: Input/output data directories

This simulation provides a flexible framework for studying turn-based game systems, matchmaking algorithms, and system performance under various load conditions.
